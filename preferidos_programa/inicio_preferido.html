<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro LevelUp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #000;
      color: #FFF;
      font-family: 'Roboto', sans-serif;
    }
    h1, h2, h3, h4, h5 {
      font-family: 'Orbitron', sans-serif;
      color: #1E90FF;
    }
    .form-control, .btn {
      margin-bottom: 15px;
    }
    .btn-primary {
      background-color: #1E90FF;
      border: none;
    }
    .btn-primary:hover {
      background-color: #1565c0;
    }
    .alert {
      margin-top: 15px;
    }
    .link-login {
      display: block;
      margin-top: 10px;
      text-align: center;
      color: #39FF14;
      font-weight: bold;
      text-decoration: none;
    }
    .link-login:hover {
      color: #1E90FF;
    }
  </style>
</head>
<body>
<div class="container py-5">
  <h1 class="text-center mb-4">Registro LevelUp</h1>
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card p-4" style="background-color:#111; border:1px solid #1E90FF;">
        <h3 class="text-center mb-3">Crea tu cuenta</h3>
        <form id="formRegistro">
          <input type="text" id="nombre" class="form-control" placeholder="Nombre completo" required>
          <input type="email" id="correo" class="form-control" placeholder="Correo electrónico" required>
          <input type="password" id="password" class="form-control" placeholder="Contraseña" required>
          <input type="text" id="codigoReferido" class="form-control" placeholder="Código de referido (opcional)">
          <button type="submit" class="btn btn-primary w-100">Registrarse</button>
        </form>
        <a href="login.html" class="link-login">O iniciar sesión</a>
        <div id="mensaje" class="alert d-none" role="alert"></div>
      </div>
    </div>
  </div>
</div>

<script>
  function generarCodigo(nombre) {
    return nombre.substring(0,3).toUpperCase() + Math.floor(Math.random()*1000);
  }

  document.getElementById("formRegistro").addEventListener("submit", function(e){
    e.preventDefault();

    let nombre = document.getElementById("nombre").value.trim();
    let correo = document.getElementById("correo").value.trim();
    let password = document.getElementById("password").value;
    let codigoReferido = document.getElementById("codigoReferido").value.trim();

    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];

    if(usuarios.some(u => u.correo === correo)) {
      mostrarMensaje("Este correo ya está registrado.", "danger");
      return;
    }

    let nuevoUsuario = {
      nombre,
      correo,
      contraseña: password,
      puntos: 0,
      codigo: generarCodigo(nombre),
      historialCompras: [],
      referidos: []
    };

    if(codigoReferido) {
      let usuarioQueRefiere = usuarios.find(u => u.codigo === codigoReferido);
      if(usuarioQueRefiere) {
        let puntosPorReferido = 100;
        let bonusDuocuc = correo.endsWith("@duocuc.cl") ? 50 : 0;
        usuarioQueRefiere.puntos += (puntosPorReferido + bonusDuocuc);
        usuarioQueRefiere.referidos.push(nuevoUsuario.codigo);
        mostrarMensaje(`¡Registro exitoso! ${usuarioQueRefiere.nombre} ganó ${puntosPorReferido + bonusDuocuc} puntos LevelUp`, "success");
      } else {
        mostrarMensaje("Código de referido no válido, pero registro exitoso.", "warning");
      }
    } else {
      mostrarMensaje("Registro exitoso.", "success");
    }

    usuarios.push(nuevoUsuario);
    localStorage.setItem("usuarios", JSON.stringify(usuarios));

    document.getElementById("formRegistro").reset();
  });

  function mostrarMensaje(texto, tipo) {
    const mensaje = document.getElementById("mensaje");
    mensaje.textContent = texto;
    mensaje.className = `alert alert-${tipo}`;
    mensaje.classList.remove("d-none");
    setTimeout(() => mensaje.classList.add("d-none"), 5000);
  }
</script>

</body>
</html>
